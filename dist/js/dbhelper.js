class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static idbInit(){return idb.open("restaurant-db",1,function(t){switch(t.oldVersion){case 0:t.createObjectStore("restaurants")}})}static getRestaurantsFromDb(t){return t.then(function(t){if(!t)return;return t.transaction("restaurants").objectStore("restaurants").get("restaurant-list")})}static updateRestaurantsInDb(t,e){return e.then(function(e){if(!e)return;let r=e.transaction("restaurants","readwrite");r.objectStore("restaurants").put(t,"restaurant-list"),r.complete})}static fetchRestaurants(t){const e=DBHelper.idbInit();DBHelper.getRestaurantsFromDb(e).then(e=>{if(!(e&&e.length>0))return fetch(DBHelper.DATABASE_URL);t(null,e)}).then(t=>{if(t)return t.json()}).then(r=>{r&&(DBHelper.updateRestaurantsInDb(r,e),t(null,r))}).catch(e=>{t(`Request failed. Error message: ${e}`,null)})}static fetchRestaurantById(t,e){DBHelper.fetchRestaurants((r,n)=>{if(r)e(r,null);else{const r=n.find(e=>e.id==t);r?e(null,r):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((r,n)=>{if(r)e(r,null);else{const r=n.filter(e=>e.cuisine_type==t);e(null,r)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((r,n)=>{if(r)e(r,null);else{const r=n.filter(e=>e.neighborhood==t);e(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,r){DBHelper.fetchRestaurants((n,a)=>{if(n)r(n,null);else{let n=a;"all"!=t&&(n=n.filter(e=>e.cuisine_type==t)),"all"!=e&&(n=n.filter(t=>t.neighborhood==e)),r(null,n)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].neighborhood),n=e.filter((t,r)=>e.indexOf(t)==r);t(null,n)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].cuisine_type),n=e.filter((t,r)=>e.indexOf(t)==r);t(null,n)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static webPImageUrlForRestaurant(t){return`dist/img/webp/${t.photograph}.webp`}static imageUrlForRestaurant(t){return`/img/${t.photograph}.jpeg`}static mapMarkerForRestaurant(t,e){const r=new L.marker([t.latlng.lat,t.latlng.lng],{title:t.name,alt:t.name,url:DBHelper.urlForRestaurant(t)});return r.addTo(newMap),r}}